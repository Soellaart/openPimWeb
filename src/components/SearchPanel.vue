<template>
  <v-row v-if="hasAccess('search') || hasAccess('searchRelations')">
    <v-col cols="12">
      <v-select v-model="searchEntityRef" :items="items" @change="onSearchEntityChange" density="compact" hide-details variant="underlined" class="mx-4 mb-0 py-0" />
      <SearchItem v-if="searchEntityRef === 'ITEM'" />
      <SearchItemRelation v-if="searchEntityRef === 'ITEM_RELATION'" />
    </v-col>
  </v-row>
</template>

<script>
import { useI18n } from 'vue-i18n'
import * as langStore from '../store/languages'
import * as searchStore from '../store/search'
import * as userStore from '../store/users'
import SearchItem from './SearchItem.vue'
import SearchItemRelation from './SearchItemRelation.vue'

export default {
  components: { SearchItem, SearchItemRelation },
  setup (props, context) {
    const { currentWhereRef, searchEntityRef, selectedRef } = searchStore.useStore()
    const { hasAccess } = userStore.useStore()
    const { currentLanguage } = langStore.useStore()
    const { t } = useI18n()

    const items = [
      { title: t('Search.Title.Items'), value: 'ITEM', disabled: !hasAccess('search') },
      { title: t('Search.Title.ItemRelations'), value: 'ITEM_RELATION', disabled: !hasAccess('searchRelations') }
    ]

    function onSearchEntityChange (val) {
      const name = {}
      name[currentLanguage.value.identifier] = t('SearchSaveDialog.NameNew')
      currentWhereRef.value = null
      selectedRef.value = { identifier: '', entity: val, name, filters: [], whereClause: {}, extended: false, public: false, orAnd: 1 }
    }

    return {
      hasAccess,
      searchEntityRef,
      currentWhereRef,
      onSearchEntityChange,
      items
    }
  }
}
</script>
